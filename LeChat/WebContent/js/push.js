jQuery.atmosphere=function(){jQuery(window).bind("unload.atmosphere",function(){jQuery.atmosphere.unsubscribe()});jQuery(window).keypress(function(b){if(b.keyCode==27){b.preventDefault()}});var a=function(c){var b,e=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,d={};while(b=e.exec(c)){d[b[1]]=b[2]}return d};return{version:"1.0",requests:[],callbacks:[],onError:function(b){},onClose:function(b){},onOpen:function(b){},onMessage:function(b){},onReconnect:function(c,b){},onMessagePublished:function(b){},onTransportFailure:function(b){},onLocalMessage:function(b){},AtmosphereRequest:function(A){var C={timeout:300000,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:true,maxRequest:60,reconnect:true,maxStreamingLength:10000000,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketUrl:null,webSocketPathDelimiter:"@@",enableXDR:false,rewriteURL:false,attachHeadersAsQueryString:true,executeCallbackBeforeReconnect:false,readyState:0,lastTimestamp:0,withCredentials:false,trackMessageLength:false,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropAtmosphereHeaders:true,uuid:0,shared:false,readResponsesHeaders:true,onError:function(aj){},onClose:function(aj){},onOpen:function(aj){},onMessage:function(aj){},onReconnect:function(ak,aj){},onMessagePublished:function(aj){},onTransportFailure:function(ak,aj){},onLocalMessage:function(aj){}};var K={status:200,responseBody:"",expectedBodySize:-1,headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",id:0};var N=null;var h=null;var m=null;var t=null;var v=null;var V=true;var f=0;var ag=false;var O=null;var ab;var j=null;var y=jQuery.now();var z;ai(A);function ac(){V=true;ag=false;f=0;N=null;h=null;m=null;t=null}function q(){X();ac()}function ai(aj){q();C=jQuery.extend(C,aj)}function i(){return C.webSocketImpl!=null||window.WebSocket||window.MozWebSocket}function G(){return window.EventSource}function l(){if(C.shared){j=U(C);if(j!=null){if(C.logLevel=="debug"){jQuery.atmosphere.debug("Storage service available. All communication will be local")}if(j.open(C)){return}}if(C.logLevel=="debug"){jQuery.atmosphere.debug("No Storage service available.")}j=null}if(C.transport!="websocket"&&C.transport!="sse"){B("opening",C.transport,C);k()}else{if(C.transport=="websocket"){if(!i()){E("Websocket is not supported, using request.fallbackTransport ("+C.fallbackTransport+")")}else{W(false)}}else{if(C.transport=="sse"){if(!G()){E("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+C.fallbackTransport+")")}else{x(false)}}}}}function U(an){var aq,ak,am,al="atmosphere-"+an.url,aj={storage:function(){if(!jQuery.atmosphere.supportStorage()){return}var au=window.localStorage,ar=function(av){return jQuery.parseJSON(au.getItem(al+"-"+av))},at=function(av,aw){au.setItem(al+"-"+av,jQuery.stringifyJSON(aw))};return{init:function(){at("children",ar("children").concat([y]));jQuery(window).on("storage.socket",function(av){av=av.originalEvent;if(av.key===al&&av.newValue){ap(av.newValue)}});return ar("opened")},signal:function(av,aw){au.setItem(al,jQuery.stringifyJSON({target:"p",type:av,data:aw}))},close:function(){var av,aw=ar("children");jQuery(window).off("storage.socket");if(aw){av=jQuery.inArray(an.id,aw);if(av>-1){aw.splice(av,1);at("children",aw)}}}}},windowref:function(){var ar=window.open("",al.replace(/\W/g,""));if(!ar||ar.closed||!ar.callbacks){return}return{init:function(){ar.callbacks.push(ap);ar.children.push(y);return ar.opened},signal:function(at,au){if(!ar.closed&&ar.fire){ar.fire(jQuery.stringifyJSON({target:"p",type:at,data:au}))}},close:function(){function at(aw,av){var au=jQuery.inArray(av,aw);if(au>-1){aw.splice(au,1)}}if(!am){at(ar.callbacks,ap);at(ar.children,y)}}}}};function ap(ar){var au=jQuery.parseJSON(ar),at=au.data;if(au.target==="c"){switch(au.type){case"open":B("opening","local",C);break;case"close":if(!am){am=true;if(at.reason==="aborted"){Z()}else{if(at.heir===y){l()}else{setTimeout(function(){u("","closed",200,C.transport);Z()},100)}}}break;case"message":u(at,"messageReceived",200,an.transport);break;case"localMessage":R(at);break}}}function ao(){var ar=new RegExp("(?:^|; )("+encodeURIComponent(al)+")=([^;]*)").exec(document.cookie);if(ar){return jQuery.parseJSON(decodeURIComponent(ar[2]))}}aq=ao();if(!aq||jQuery.now()-aq.ts>1000){return}ak=aj.storage()||aj.windowref();if(!ak){return}return{open:function(){var ar;z=setInterval(function(){var at=aq;aq=ao();if(!aq||at.ts===aq.ts){ap(jQuery.stringifyJSON({target:"c",type:"close",data:{reason:"error",heir:at.heir}}))}},1000);ar=ak.init();if(ar){setTimeout(function(){B("opening","local",an)},50)}return ar},send:function(ar){ak.signal("send",ar)},localSend:function(ar){ak.signal("localSend",jQuery.stringifyJSON({id:y,event:ar}))},close:function(){if(!ag){clearInterval(z);ak.signal("close");ak.close()}}}}function S(){var ak,aj="atmosphere-"+C.url,ao={storage:function(){if(!jQuery.atmosphere.supportStorage()){return}var ap=window.localStorage;return{init:function(){jQuery(window).on("storage.socket",function(aq){aq=aq.originalEvent;if(aq.key===aj&&aq.newValue){al(aq.newValue)}})},signal:function(aq,ar){ap.setItem(aj,jQuery.stringifyJSON({target:"c",type:aq,data:ar}))},get:function(aq){return jQuery.parseJSON(ap.getItem(aj+"-"+aq))},set:function(aq,ar){ap.setItem(aj+"-"+aq,jQuery.stringifyJSON(ar))},close:function(){jQuery(window).off("storage.socket");ap.removeItem(aj);ap.removeItem(aj+"-opened");ap.removeItem(aj+"-children")}}},windowref:function(){var ap=aj.replace(/\W/g,""),aq=(jQuery('iframe[name="'+ap+'"]')[0]||jQuery('<iframe name="'+ap+'" />').hide().appendTo("body")[0]).contentWindow;return{init:function(){aq.callbacks=[al];aq.fire=function(ar){var at;for(at=0;at<aq.callbacks.length;at++){aq.callbacks[at](ar)}}},signal:function(ar,at){if(!aq.closed&&aq.fire){aq.fire(jQuery.stringifyJSON({target:"c",type:ar,data:at}))}},get:function(ar){return !aq.closed?aq[ar]:null},set:function(ar,at){if(!aq.closed){aq[ar]=at}},close:function(){}}}};function al(ap){var ar=jQuery.parseJSON(ap),aq=ar.data;if(ar.target==="p"){switch(ar.type){case"send":Y(aq);break;case"localSend":R(aq);break;case"close":Z();break}}}O=function an(ap){ak.signal("message",ap)};function am(){document.cookie=encodeURIComponent(aj)+"="+encodeURIComponent(jQuery.stringifyJSON({ts:jQuery.now()+1,heir:(ak.get("children")||[])[0]}))}ak=ao.storage()||ao.windowref();ak.init();if(C.logLevel=="debug"){jQuery.atmosphere.debug("Installed StorageService "+ak)}ak.set("children",[]);if(ak.get("opened")!=null&&!ak.get("opened")){ak.set("opened",false)}am();z=setInterval(am,1000);ab=ak}function B(al,an,ak){if(C.shared&&an!="local"){S()}if(ab!=null){ab.set("opened",true)}ak.close=function(){Z();ak.reconnect=false};K.request=ak;var am=K.state;K.state=al;K.status=200;var aj=K.transport;K.transport=an;s();K.state=am;K.transport=aj}function p(al){var ak=C;if((al!=null)&&(typeof(al)!="undefined")){ak=al}var aj=ak.url;var am=ak.data;if(ak.attachHeadersAsQueryString){aj=L(ak);if(am!=""){aj+="&X-Atmosphere-Post-Body="+am}am=""}v=jQuery.ajax({url:aj,type:ak.method,dataType:"jsonp",error:function(an,ap,ao){if(an.status<300&&ak.requestCount++<ak.maxRequest){F(v,ak)}else{u(ap,"error",an.status,ak.transport)}},jsonp:"jsonpTransport",success:function(an){if(ak.requestCount++<ak.maxRequest){if(!ak.executeCallbackBeforeReconnect){F(v,ak)}var ap=an.message;if(ap!=null&&typeof ap!="string"){try{ap=jQuery.stringifyJSON(ap)}catch(ao){}}u(ap,"messageReceived",200,ak.transport);if(ak.executeCallbackBeforeReconnect){F(v,ak)}}else{jQuery.atmosphere.log(C.logLevel,["JSONP reconnect maximum try reached "+C.requestCount]);T()}},data:ak.data,beforeSend:function(an){b(an,ak,false)}})}function P(al){var ak=C;if((al!=null)&&(typeof(al)!="undefined")){ak=al}var aj=ak.url;var am=ak.data;if(ak.attachHeadersAsQueryString){aj=L(ak);if(am!=""){aj+="&X-Atmosphere-Post-Body="+am}am=""}v=jQuery.ajax({url:aj,type:ak.method,error:function(an,ap,ao){if(an.status<300&&ak.requestCount++<ak.maxRequest){F(v,ak)}else{u(ap,"error",an.status,ak.transport)}},success:function(ao,ap,an){if(ak.requestCount++<ak.maxRequest){if(!ak.executeCallbackBeforeReconnect){F(v,ak)}u(ao,"messageReceived",200,ak.transport);if(ak.executeCallbackBeforeReconnect){F(v,ak)}}else{jQuery.atmosphere.log(C.logLevel,["AJAX reconnect maximum try reached "+C.requestCount]);T()}},data:ak.data,beforeSend:function(an){b(an,ak,false)}})}function d(aj){if(C.webSocketImpl!=null){return C.webSocketImpl}else{if(window.WebSocket){return new WebSocket(aj)}else{return new MozWebSocket(aj)}}}function e(){var aj=L(C);return decodeURI(jQuery('<a href="'+aj+'"/>')[0].href.replace(/^http/,"ws"))}function ah(){var aj=L(C);return aj}function x(ak){K.transport="sse";var aj=ah(C.url);if(C.logLevel=="debug"){jQuery.atmosphere.debug("Invoking executeSSE");jQuery.atmosphere.debug("Using URL: "+aj)}if(ak){B("re-opening","sse",C)}if(!C.reconnect){if(h!=null){h.close()}return}h=new EventSource(aj,{withCredentials:C.withCredentials});if(C.connectTimeout>0){C.id=setTimeout(function(){if(!ak){h.close()}},C.connectTimeout)}h.onopen=function(al){if(C.logLevel=="debug"){jQuery.atmosphere.debug("SSE successfully opened")}if(!ak){B("opening","sse",C)}ak=true;if(C.method=="POST"){K.state="messageReceived";h.send(C.data)}};h.onmessage=function(am){if(am.origin!="http://"+window.location.host){jQuery.atmosphere.log(C.logLevel,["Origin was not http://"+window.location.host]);return}K.state="messageReceived";K.status=200;var am=am.data;var al=o(am,C,K);if(jQuery.trim(am).length==0){al=true}if(!al){s();K.responseBody=""}};h.onerror=function(al){clearTimeout(C.id);K.state="closed";K.responseBody="";K.status=!ak?501:200;s();h.close();if(ag){jQuery.atmosphere.log(C.logLevel,["SSE closed normally"])}else{if(!ak){E("SSE failed. Downgrading to fallback transport and resending")}else{if(C.reconnect&&(K.transport=="sse")){C.requestCount=f;if(f++<C.maxRequest){C.id=setTimeout(function(){x(true)},C.reconnectInterval);K.responseBody=""}else{jQuery.atmosphere.log(C.logLevel,["SSE reconnect maximum try reached "+C.requestCount]);T()}}}}}}function W(ak){K.transport="websocket";var aj=e(C.url);var al=false;if(C.logLevel=="debug"){jQuery.atmosphere.debug("Invoking executeWebSocket");jQuery.atmosphere.debug("Using URL: "+aj)}if(ak){B("re-opening","websocket",C)}if(!C.reconnect){if(N!=null){N.close()}return}N=d(aj);if(C.connectTimeout>0){C.id=setTimeout(function(){if(!ak){var am={code:1002,reason:"",wasClean:false};N.onclose(am);try{N.close()}catch(an){}}},C.connectTimeout)}N.onopen=function(am){if(C.logLevel=="debug"){jQuery.atmosphere.debug("Websocket successfully opened")}if(!ak){B("opening","websocket",C)}ak=true;if(C.method=="POST"){K.state="messageReceived";N.send(C.data)}};N.onmessage=function(an){if(an.data.indexOf("parent.callback")!=-1){jQuery.atmosphere.log(C.logLevel,["parent.callback no longer supported with 0.8 version and up. Please upgrade"])}K.state="messageReceived";K.status=200;var an=an.data;var am=o(an,C,K);if(!am){s();K.responseBody=""}};N.onerror=function(am){clearTimeout(C.id)};N.onclose=function(am){if(al){return}var an=am.reason;if(an===""){switch(am.code){case 1000:an="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:an="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:an="The endpoint is terminating the connection due to a protocol error.";break;case 1003:an="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:an="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:an="Unknown: no status code was provided even though one was expected.";break;case 1006:an="Connection was closed abnormally (that is, with no close frame being sent).";break}}jQuery.atmosphere.warn("Websocket closed, reason: "+an);jQuery.atmosphere.warn("Websocket closed, wasClean: "+am.wasClean);K.state="closed";K.responseBody="";K.status=!ak?501:200;s();clearTimeout(C.id);al=true;if(ag){jQuery.atmosphere.log(C.logLevel,["Websocket closed normally"])}else{if(!ak){E("Websocket failed. Downgrading to Comet and resending")}else{if(C.reconnect&&K.transport=="websocket"){if(C.reconnect&&f++<C.maxRequest){C.requestCount=f;K.responseBody="";W(true)}else{jQuery.atmosphere.log(C.logLevel,["Websocket reconnect maximum try reached "+C.requestCount]);jQuery.atmosphere.warn("Websocket error, reason: "+am.reason);T()}}}}}}function T(){K.state="error";K.responseBody="";K.status=500;s()}function o(an,am,aj){if(am.trackMessageLength){if(aj.partialMessage.length!=0){an=aj.partialMessage+an}var al=[];var ao=0;var ak=an.indexOf(am.messageDelimiter);while(ak!=-1){ao=an.substring(ao,ak);an=an.substring(ak+am.messageDelimiter.length,an.length);if(an.length==0||an.length<ao){break}ak=an.indexOf(am.messageDelimiter);al.push(an.substring(0,ao))}if(an.length!=0&&ao!=0){aj.partialMessage=ao+am.messageDelimiter+an}if(al.length!=0){aj.responseBody=al.join(am.messageDelimiter);return false}else{return true}}else{aj.responseBody=an}return false}function E(aj){jQuery.atmosphere.log(C.logLevel,[aj]);if(typeof(C.onTransportFailure)!="undefined"){C.onTransportFailure(aj,C)}else{if(typeof(jQuery.atmosphere.onTransportFailure)!="undefined"){jQuery.atmosphere.onTransportFailure(aj,C)}}C.transport=C.fallbackTransport;if(C.reconnect&&C.transport!="none"||C.transport==null){C.method=C.fallbackMethod;K.transport=C.fallbackTransport;C.id=setTimeout(function(){l()},C.reconnectInterval)}}function L(al){var ak=C;if((al!=null)&&(typeof(al)!="undefined")){ak=al}var aj=ak.url;if(!ak.attachHeadersAsQueryString){return aj}if(aj.indexOf("X-Atmosphere-Framework")!=-1){return aj}aj+=(aj.indexOf("?")!=-1)?"&":"?";aj+="X-Atmosphere-tracking-id="+ak.uuid;aj+="&X-Atmosphere-Framework="+jQuery.atmosphere.version;aj+="&X-Atmosphere-Transport="+ak.transport;if(ak.trackMessageLength){aj+="&X-Atmosphere-TrackMessageSize=true"}if(ak.lastTimestamp!=undefined){aj+="&X-Cache-Date="+ak.lastTimestamp}else{aj+="&X-Cache-Date="+0}if(ak.contentType!=""){aj+="&Content-Type="+ak.contentType}jQuery.each(ak.headers,function(am,ao){var an=jQuery.isFunction(ao)?ao.call(this,ak,al,K):ao;if(an!=null){aj+="&"+encodeURIComponent(am)+"="+encodeURIComponent(an)}});return aj}function ad(){var al;if(jQuery.browser.msie){var aj=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(var ak=0;ak<aj.length;ak++){try{al=new ActiveXObject(aj[ak])}catch(am){}}}else{if(window.XMLHttpRequest){al=new XMLHttpRequest()}}return al}function k(am){var ak=C;if((am!=null)||(typeof(am)!="undefined")){ak=am}if((ak.transport=="jsonp")||((ak.enableXDR)&&(jQuery.atmosphere.checkCORSSupport()))){p(ak);return}if(ak.transport=="ajax"){P(am);return}if((ak.transport=="streaming")&&(jQuery.browser.msie)){ak.enableXDR&&window.XDomainRequest?D(ak):af(ak);return}if((ak.enableXDR)&&(window.XDomainRequest)){D(ak);return}if(ak.reconnect&&ak.requestCount++<ak.maxRequest){var al=ad();b(al,ak,true);if(ak.suspend){m=al}if(ak.transport!="polling"){K.transport=ak.transport}var aj=false;if(!jQuery.browser.msie){al.onerror=function(){aj=true;try{K.status=XMLHttpRequest.status}catch(an){K.status=404}K.state="error";F(al,ak,true)}}al.onreadystatechange=function(){if(ag){return}var aq=false;var ap=false;if(ak.transport=="streaming"&&(ak.readyState>2&&al.readyState==4)){ak.readyState=0;ak.lastIndex=0;F(al,ak,true);return}ak.readyState=al.readyState;if(al.readyState==4){if(jQuery.browser.msie){ap=true}else{if(ak.transport=="streaming"){ap=true}else{if(ak.transport=="long-polling"){ap=true;clearTimeout(ak.id)}}}}else{if(!jQuery.browser.msie&&al.readyState==3&&al.status==200&&ak.transport!="long-polling"){ap=true}else{clearTimeout(ak.id)}}try{if(ak.readResponsesHeaders){var av=al.getResponseHeader("X-Atmosphere-tracking-id");if(av!=null||av!=undefined){C.uuid=av.split(" ").pop()}}}catch(ar){}if(ap){var au=al.responseText;try{if(ak.readResponsesHeaders){var an=al.getResponseHeader("X-Cache-Date");if(an!=null||an!=undefined){C.lastTimestamp=an.split(" ").pop()}}}catch(ar){}if(ak.transport=="streaming"){var ax=au.substring(ak.lastIndex,au.length);K.isJunkEnded=true;if(!K.junkFull&&(ax.indexOf("<!-- Welcome to the Atmosphere Framework.")==-1||ax.indexOf("<!-- EOD -->")==-1)){return}K.junkFull=true;if(ak.lastIndex==0&&ax.indexOf("<!-- Welcome to the Atmosphere Framework.")!=-1&&ax.indexOf("<!-- EOD -->")!=-1){K.isJunkEnded=false}if(!K.isJunkEnded){var aw="<!-- EOD -->";var at=aw.length;var ao=ax.indexOf(aw)+at;if(ao>at&&ao!=ax.length){K.responseBody=ax.substring(ao);aq=o(K.responseBody,ak,K)}else{aq=true}}else{var ay=au.substring(ak.lastIndex,au.length);aq=o(ay,ak,K)}ak.lastIndex=au.length;if(jQuery.browser.opera){jQuery.atmosphere.iterate(function(){if(al.responseText.length>ak.lastIndex){try{K.status=al.status;K.headers=a(al.getAllResponseHeaders());if(C.readResponsesHeaders&&C.headers){jQuery.each(C.headers,function(aB){var aA=al.getResponseHeader(aB);if(aA){K.headers[aB]=aA}})}}catch(az){K.status=404}K.state="messageReceived";K.responseBody=al.responseText.substring(ak.lastIndex);ak.lastIndex=al.responseText.length;s();if((ak.transport=="streaming")&&(al.responseText.length>ak.maxStreamingLength)){al.abort();b(al,ak,true)}}},0)}if(aq){return}}else{aq=o(au,ak,K);ak.lastIndex=au.length}try{K.status=al.status;K.headers=a(al.getAllResponseHeaders());if(C.readResponsesHeaders&&C.headers){jQuery.each(C.headers,function(aA){var az=al.getResponseHeader(aA);if(az){K.headers[aA]=az}})}}catch(ar){K.status=404}if(ak.suspend){K.state=K.status==0?"closed":"messageReceived"}else{K.state="messagePublished"}if(!ak.executeCallbackBeforeReconnect){F(al,ak,false)}if(K.responseBody.indexOf("parent.callback")!=-1){jQuery.atmosphere.log(ak.logLevel,["parent.callback no longer supported with 0.8 version and up. Please upgrade"])}s();if(ak.executeCallbackBeforeReconnect){F(al,ak,false)}if((ak.transport=="streaming")&&(au.length>ak.maxStreamingLength)){al.abort();b(al,ak,true)}}};al.send(ak.data);if(ak.suspend){ak.id=setTimeout(function(){if(V){al.abort();ai(ak);l()}},ak.timeout)}V=true}else{jQuery.atmosphere.log(ak.logLevel,["Max re-connection reached."]);T()}}function b(al,am,ak){var aj=L(am);aj=jQuery.atmosphere.prepareURL(aj);if(ak){al.open(am.method,aj,true);if(am.connectTimeout>-1){am.id=setTimeout(function(){if(am.requestCount==0){al.abort();u("Connect timeout","closed",200,am.transport)}},am.connectTimeout)}}if(C.withCredentials){if("withCredentials" in al){al.withCredentials=true}}if(!C.dropAtmosphereHeaders){al.setRequestHeader("X-Atmosphere-Framework",jQuery.atmosphere.version);al.setRequestHeader("X-Atmosphere-Transport",am.transport);if(am.lastTimestamp!=undefined){al.setRequestHeader("X-Cache-Date",am.lastTimestamp)}else{al.setRequestHeader("X-Cache-Date",0)}if(am.trackMessageLength){al.setRequestHeader("X-Atmosphere-TrackMessageSize","true")}if(am.contentType!=""){al.setRequestHeader("Content-Type",am.contentType)}al.setRequestHeader("X-Atmosphere-tracking-id",am.uuid)}jQuery.each(am.headers,function(an,ap){var ao=jQuery.isFunction(ap)?ap.call(this,al,am,ak,K):ap;if(ao!=null){al.setRequestHeader(an,ao)}})}function F(aj,ak,al){if(al||(ak.suspend&&aj.status==200&&ak.transport!="streaming"&&V)){if(ak.reconnect){B("re-opening",ak.transport,ak);ak.id=setTimeout(function(){k()},ak.reconnectInterval)}}}function D(aj){t=J(aj);t.open()}function J(am){var al=C;if((am!=null)&&(typeof(am)!="undefined")){al=am}var ak="";var aq=al.transport;var ap=0;var ao=function(at){var aw=at.responseText;var ax=false;if(aw.indexOf("<!-- Welcome to the Atmosphere Framework.")!=-1){ax=true}if(ax){var av="<!-- EOD -->";var ar=av.length;var au=aw.indexOf(av);if(au!==-1){aw=aw.substring(au+ar+ap);ap+=aw.length}}u(aw,"messageReceived",200,aq)};var aj=new window.XDomainRequest();var an=al.rewriteURL||function(at){var ar=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(ar&&ar[1]){case"JSESSIONID":return at.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+ar[2]+"$1");case"PHPSESSID":return at.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+ar[2]+"&").replace(/&$/,"")}return at};aj.onprogress=function(){ao(aj)};aj.onerror=function(){if(al.transport!="polling"){u(aj.responseText,"error",500,aq)}};aj.onload=function(){if(ak!=aj.responseText){ao(aj)}if(al.transport=="long-polling"){k()}};return{open:function(){if(al.method=="POST"){al.attachHeadersAsQueryString=true}var ar=L(al);if(al.method=="POST"){ar+="&X-Atmosphere-Post-Body="+al.data}aj.open(al.method,an(ar));aj.send();if(al.connectTimeout>-1){al.id=setTimeout(function(){if(al.requestCount==0){aj.abort();u("Connect timeout","closed",200,al.transport)}},al.connectTimeout)}},close:function(){aj.abort();u(aj.responseText,"closed",200,aq)}}}function af(aj){t=n(aj);t.open()}function n(am){var al=C;if((am!=null)&&(typeof(am)!="undefined")){al=am}var ak;var an=new window.ActiveXObject("htmlfile");an.open();an.close();var aj=al.url;if(al.transport!="polling"){K.transport=al.transport}return{open:function(){var ao=an.createElement("iframe");aj=L(al);if(al.data!=""){aj+="&X-Atmosphere-Post-Body="+al.data}aj=jQuery.atmosphere.prepareURL(aj);ao.src=aj;an.body.appendChild(ao);var ap=ao.contentDocument||ao.contentWindow.document;ak=jQuery.atmosphere.iterate(function(){try{if(!ap.firstChild){return}if(ap.readyState==="complete"){try{jQuery.noop(ap.fileSize)}catch(aw){u("Connection Failure","error",500,al.transport);return false}}var at=ap.body?ap.body.lastChild:ap;var av=function(){var aC=at.cloneNode(true);aC.appendChild(ap.createTextNode("."));var aA=aC.innerText;var aB=true;if(aA.indexOf("<!-- Welcome to the Atmosphere Framework.")==-1){aB=false}if(aB){var az="<!-- EOD -->";var ax=az.length;var ay=aA.indexOf(az)+ax;aA=aA.substring(ay)}return aA.substring(0,aA.length-1)};if(!jQuery.nodeName(at,"pre")){var ar=ap.head||ap.getElementsByTagName("head")[0]||ap.documentElement||ap;var aq=ap.createElement("script");aq.text="document.write('<plaintext>')";ar.insertBefore(aq,ar.firstChild);ar.removeChild(aq);at=ap.body.lastChild}u(av(),"opening",200,al.transport);ak=jQuery.atmosphere.iterate(function(){var ax=av();if(ax.length>al.lastIndex){K.status=200;u(ax,"messageReceived",200,al.transport);at.innerText="";al.lastIndex=0}if(ap.readyState==="complete"){u("","re-opening",200,al.transport);af(al);return false}},null);return false}catch(au){jQuery.atmosphere.error(au)}})},close:function(){if(ak){ak()}an.execCommand("Stop");u("","closed",200,al.transport)}}}function Y(aj){if(j!=null){g(aj)}else{if(m!=null||h!=null){c(aj)}else{if(t!=null){M(aj)}else{if(v!=null){I(aj)}else{if(N!=null){w(aj)}}}}}}function g(aj){j.send(aj)}function r(ak){if(ak.length==0){return}try{if(j){j.localSend(ak)}else{ab.signal("localMessage",jQuery.stringifyJSON({id:y,event:ak}))}}catch(aj){jQuery.atmosphere.error(aj)}}function c(ak){var aj=aa(ak);k(aj)}function M(ak){if(C.enableXDR&&jQuery.atmosphere.checkCORSSupport()){var aj=aa(ak);aj.reconnect=false;p(aj)}else{c(ak)}}function I(aj){c(aj)}function H(aj){var ak=aj;if(typeof(ak)=="object"){ak=aj.data}return ak}function aa(ak){var al=H(ak);var aj={connected:false,timeout:60000,method:"POST",url:C.url,contentType:C.contentType,headers:{},reconnect:true,callback:null,data:al,suspend:false,maxRequest:60,logLevel:"info",requestCount:0,transport:"polling",attachHeadersAsQueryString:true,enableXDR:C.enableXDR,uuid:C.uuid};if(typeof(ak)=="object"){aj=jQuery.extend(aj,ak)}return aj}function w(aj){var am=H(aj);var ak;try{if(C.webSocketUrl!=null){ak=C.webSocketPathDelimiter+C.webSocketUrl+C.webSocketPathDelimiter+am}else{ak=am}N.send(ak)}catch(al){N.onclose=function(an){};N.close();E("Websocket failed. Downgrading to Comet and resending "+ak);c(aj)}}function R(ak){var aj=jQuery.parseJSON(ak);if(aj.id!=y){if(typeof(C.onLocalMessage)!="undefined"){C.onLocalMessage(aj.event)}else{if(typeof(jQuery.atmosphere.onLocalMessage)!="undefined"){jQuery.atmosphere.onLocalMessage(aj.event)}}}}function u(am,aj,ak,al){if(aj=="messageReceived"){if(o(am,C,K)){return}}K.transport=al;K.status=ak;if(K.expectedBodySize==-1){K.responseBody=am}K.state=aj;s()}function Q(aj){ae(aj,C);ae(aj,jQuery.atmosphere)}function ae(aj,ak){switch(aj.state){case"messageReceived":if(typeof(ak.onMessage)!="undefined"){ak.onMessage(aj)}break;case"error":if(typeof(ak.onError)!="undefined"){ak.onError(aj)}break;case"opening":if(typeof(ak.onOpen)!="undefined"){ak.onOpen(aj)}break;case"messagePublished":if(typeof(ak.onMessagePublished)!="undefined"){ak.onMessagePublished(aj)}break;case"re-opening":if(typeof(ak.onReconnect)!="undefined"){ak.onReconnect(C,aj)}break;case"unsubscribe":case"closed":if(typeof(ak.onClose)!="undefined"){ak.onClose(aj)}break}}function s(){var am=function(ap,aq){aq(K)};if(j==null&&O!=null){O(K.responseBody)}var an=typeof(K.responseBody)=="string"?K.responseBody.split(C.messageDelimiter):new Array(K.responseBody);for(var ak=0;ak<an.length;ak++){if(an.length>1&&an[ak].length==0){continue}K.responseBody=jQuery.trim(an[ak]);if(K.responseBody.length==0&&K.transport=="streaming"&&K.state=="messageReceived"){var aj=navigator.userAgent.toLowerCase();var al=aj.indexOf("android")>-1;if(al){continue}}Q(K);if(jQuery.atmosphere.callbacks.length>0){if(C.logLevel=="debug"){jQuery.atmosphere.debug("Invoking "+jQuery.atmosphere.callbacks.length+" global callbacks: "+K.state)}try{jQuery.each(jQuery.atmosphere.callbacks,am)}catch(ao){jQuery.atmosphere.log(C.logLevel,["Callback exception"+ao])}}if(typeof(C.callback)=="function"){if(C.logLevel=="debug"){jQuery.atmosphere.debug("Invoking request callbacks")}try{C.callback(K)}catch(ao){jQuery.atmosphere.log(C.logLevel,["Callback exception"+ao])}}}}function Z(){C.reconnect=false;K.request=C;V=false;ag=true;K.state="unsubscribe";K.responseBody="";K.status=408;s();X();if(j==null&&O!=null){clearInterval(z);document.cookie=encodeURIComponent(name)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT";ab.signal("close",{reason:"",heir:!ag?y:(ab.get("children")||[])[0]})}if(ab!=null){ab.close()}if(j!=null){j.close()}}function X(){if(t!=null){t.close();t=null}if(v!=null){v.abort();v=null}if(m!=null){m.abort();m=null}if(N!=null){N.close();N=null}if(h!=null){h.close();h=null}}this.subscribe=function(aj){ai(aj);l()};this.execute=function(){l()};this.invokeCallback=function(){s()};this.close=function(){Z()};this.getUrl=function(){return C.url};this.push=function(aj){Y(aj)};this.pushLocal=function(aj){r(aj)};this.response=K},subscribe:function(b,e,d){if(typeof(e)=="function"){jQuery.atmosphere.addCallback(e)}if(typeof(b)!="string"){d=b}else{d.url=b}var c=new jQuery.atmosphere.AtmosphereRequest(d);c.execute();jQuery.atmosphere.requests[jQuery.atmosphere.requests.length]=c;return c},addCallback:function(b){if(jQuery.inArray(b,jQuery.atmosphere.callbacks)==-1){jQuery.atmosphere.callbacks.push(b)}},removeCallback:function(c){var b=jQuery.inArray(c,jQuery.atmosphere.callbacks);if(b!=-1){jQuery.atmosphere.callbacks.splice(b,1)}},unsubscribe:function(){if(jQuery.atmosphere.requests.length>0){for(var b=0;b<jQuery.atmosphere.requests.length;b++){jQuery.atmosphere.requests[b].close();clearTimeout(jQuery.atmosphere.requests[b].id)}}jQuery.atmosphere.requests=[];jQuery.atmosphere.callbacks=[]},unsubscribeUrl:function(c){var b=-1;if(jQuery.atmosphere.requests.length>0){for(var e=0;e<jQuery.atmosphere.requests.length;e++){var d=jQuery.atmosphere.requests[e];if(d.getUrl()==c){d.close();clearTimeout(d.id);b=e;break}}}if(b>=0){jQuery.atmosphere.requests.splice(b,1)}},publish:function(c){if(typeof(c.callback)=="function"){jQuery.atmosphere.addCallback(callback)}c.transport="polling";var b=new jQuery.atmosphere.AtmosphereRequest(c);jQuery.atmosphere.requests[jQuery.atmosphere.requests.length]=b;return b},checkCORSSupport:function(){if(jQuery.browser.msie&&!window.XDomainRequest){return true}else{if(jQuery.browser.opera){return true}}var b=navigator.userAgent.toLowerCase();var c=b.indexOf("android")>-1;if(c){return true}return false},S4:function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)},guid:function(){return(jQuery.atmosphere.S4()+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+jQuery.atmosphere.S4()+jQuery.atmosphere.S4())},prepareURL:function(c){var d=jQuery.now();var b=c.replace(/([?&])_=[^&]*/,"$1_="+d);return b+(b===c?(/\?/.test(c)?"&":"?")+"_="+d:"")},param:function(b){return jQuery.param(b,jQuery.ajaxSettings.traditional)},supportStorage:function(){var c=window.localStorage;if(c){try{c.setItem("t","t");c.removeItem("t");return window.StorageEvent&&!jQuery.browser.msie&&!(jQuery.browser.mozilla&&jQuery.browser.version.split(".")[0]==="1")}catch(b){}}return false},iterate:function(d,c){var e;c=c||0;(function b(){e=setTimeout(function(){if(d()===false){return}b()},c)})();return function(){clearTimeout(e)}},log:function(d,c){if(window.console){var b=window.console[d];if(typeof b=="function"){b.apply(window.console,c)}}},warn:function(){jQuery.atmosphere.log("warn",arguments)},info:function(){jQuery.atmosphere.log("info",arguments)},debug:function(){jQuery.atmosphere.log("debug",arguments)},error:function(){jQuery.atmosphere.log("error",arguments)}}}();(function(d){var g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(f){return'"'+f.replace(g,function(h){var i=c[h];return typeof i==="string"?i:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"'}function b(f){return f<10?"0"+f:f}function e(m,l){var k,j,f,h,o=l[m],n=typeof o;if(o&&typeof o==="object"&&typeof o.toJSON==="function"){o=o.toJSON(m);n=typeof o}switch(n){case"string":return a(o);case"number":return isFinite(o)?String(o):"null";case"boolean":return String(o);case"object":if(!o){return"null"}switch(Object.prototype.toString.call(o)){case"[object Date]":return isFinite(o.valueOf())?'"'+o.getUTCFullYear()+"-"+b(o.getUTCMonth()+1)+"-"+b(o.getUTCDate())+"T"+b(o.getUTCHours())+":"+b(o.getUTCMinutes())+":"+b(o.getUTCSeconds())+'Z"':"null";case"[object Array]":f=o.length;h=[];for(k=0;k<f;k++){h.push(e(k,o)||"null")}return"["+h.join(",")+"]";default:h=[];for(k in o){if(Object.prototype.hasOwnProperty.call(o,k)){j=e(k,o);if(j){h.push(a(k)+":"+j)}}}return"{"+h.join(",")+"}"}}}d.stringifyJSON=function(f){if(window.JSON&&window.JSON.stringify){return window.JSON.stringify(f)}return e("",{"":f})}}(jQuery));PrimeFaces.widget.Socket=PrimeFaces.widget.BaseWidget.extend({init:function(b){this.cfg=b;var a=this;this.cfg.request={url:this.cfg.url,transport:"websocket",fallbackTransport:"long-polling",enableXDR:false,onMessage:function(c){a.onMessage(c)}};if(this.cfg.autoConnect){this.connect()}},connect:function(a){if(a){this.cfg.request.url+=a}this.connection=$.atmosphere.subscribe(this.cfg.request)},push:function(a){this.connection.push(JSON.stringify(a))},onMessage:function(a){var b=$.parseJSON(a.responseBody);if(this.cfg.onMessage){this.cfg.onMessage.call(this,b.data)}if(this.cfg.behaviors&&this.cfg.behaviors.message){this.cfg.behaviors.message.call(this)}}});